# 语音识别调试指南

## 🎯 如何查看识别结果

现在系统已经添加了详细的日志输出，你可以在以下位置查看识别结果：

### 1. 服务器端（终端）

运行 `./scripts/start_funasr.sh` 的终端会显示：

```
============================================================
🎤 语音识别结果: 你好，我是张爷爷
============================================================
```

### 2. 浏览器控制台

打开浏览器开发者工具（F12），在 Console 标签页会看到：

```
[FunASR] ✅ 服务器已就绪，可以开始录音
[FunASR] 🔄 中间结果: 你好
[FunASR] 🔄 中间结果: 你好，我是
[FunASR] ✅ 最终结果: 你好，我是张爷爷
============================================================
✅ 最终识别结果: "你好，我是张爷爷"
============================================================
[SpeechService] 收到识别结果: {text: "你好，我是张爷爷", isFinal: true}
[ElderlyApp] ✅ 最终识别结果: "你好，我是张爷爷"
[ElderlyApp] 正在调用 AI 服务处理: 你好，我是张爷爷
[ElderlyApp] AI 服务响应: 张爷爷，您好！有什么我可以帮您的吗？
```

## 🔍 调试步骤

### 步骤 1：检查服务器是否运行

```bash
# 检查进程
ps aux | grep funasr_server.py

# 检查端口
lsof -i :10095
```

### 步骤 2：检查浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签页
3. 点击麦克风按钮开始录音
4. 说话后查看控制台输出

### 步骤 3：检查服务器日志

在运行 `./scripts/start_funasr.sh` 的终端查看：

- 是否显示 "服务器已启动"
- 是否显示客户端连接
- 是否显示识别结果

## 🐛 常见问题

### 问题 1：没有看到识别结果

**检查**：
1. 服务器是否正在运行？
2. 浏览器控制台是否有错误？
3. 麦克风权限是否已授予？

**解决**：
```bash
# 重启服务器
./scripts/start_funasr.sh
```

### 问题 2：识别结果为空

**可能原因**：
- 音频数据太短
- 没有检测到语音
- 环境噪音太大

**解决**：
- 说话声音大一点
- 靠近麦克风
- 在安静环境中测试

### 问题 3：识别结果不准确

**可能原因**：
- 模型还在加载中
- 音频质量不好
- 说话太快或不清楚

**解决**：
- 等待模型完全加载（看到 "模型加载完成"）
- 清晰、缓慢地说话
- 检查麦克风质量

## 📊 日志级别说明

### 服务器端日志

- `INFO`: 正常操作信息
- `WARNING`: 警告（如音频太短）
- `ERROR`: 错误信息

### 浏览器控制台日志

- `[FunASR]`: FunASR 客户端日志
- `[SpeechService]`: 语音识别服务日志
- `[ElderlyApp]`: 主应用日志

## ✅ 验证识别是否成功

### 方法 1：查看控制台

如果看到以下输出，说明识别成功：

```
[FunASR] ✅ 最终结果: "你的语音内容"
[ElderlyApp] ✅ 最终识别结果: "你的语音内容"
```

### 方法 2：查看 UI

- 语音输入应该显示在对话框中
- AI 应该会回复

### 方法 3：查看服务器终端

服务器终端应该显示：

```
🎤 语音识别结果: 你的语音内容
```

## 🎯 快速测试

1. **启动服务器**：
   ```bash
   ./scripts/start_funasr.sh
   ```

2. **打开浏览器**：
   - 打开开发者工具（F12）
   - 切换到 Console 标签页

3. **开始录音**：
   - 点击麦克风按钮
   - 说："你好"

4. **查看结果**：
   - 控制台应该显示识别结果
   - 服务器终端也应该显示识别结果

## 📝 注意事项

- 首次识别可能需要几秒钟
- 确保在安静环境中测试
- 说话清晰、不要太快
- 如果识别失败，检查所有日志输出
