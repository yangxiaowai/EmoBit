# 快速调试指南：语音识别后没有回复

## 🔍 立即检查步骤

### 步骤 1: 打开浏览器控制台

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签页
3. **清空控制台**（点击清除按钮或按 `Ctrl+L`）

### 步骤 2: 测试语音识别

1. 点击麦克风按钮开始录音
2. 说一句话（例如："你好"）
3. 停止录音

### 步骤 3: 查看控制台输出

**应该按顺序看到以下日志**：

#### ✅ 正常流程应该看到：

```
[FunASR] ✅ 服务器已就绪，可以开始录音
[FunASR] 🔄 中间结果: 你好
[FunASR] ✅ 最终结果: 你好
============================================================
🎤 语音识别完成: "你好"
============================================================
[SpeechService] 收到识别结果: {text: "你好", isFinal: true}
[ElderlyApp] ============================================================
[ElderlyApp] ✅ 最终识别结果: "你好"
[ElderlyApp] ============================================================
[ElderlyApp] 正在调用 AI 服务处理: 你好
[ElderlyApp] ============================================================
[ElderlyApp] 调用 AI 服务，输入: 你好
[ElderlyApp] ============================================================
[AI] ============================================================
[AI] 收到用户消息: 你好
[AI] ============================================================
[AI] ✅ 使用本地回复（节省API调用）
[AI] 回复内容: 张爷爷，您好！今天感觉怎么样？
[AI] ============================================================
[ElderlyApp] ✅ AI 服务响应: {text: "张爷爷，您好！今天感觉怎么样？", ...}
[ElderlyApp] ✅ AI 服务调用成功，回复: 张爷爷，您好！今天感觉怎么样？
[ElderlyApp] 开始播放 AI 回复: 张爷爷，您好！今天感觉怎么样？
[ElderlyApp] Edge TTS 服务状态: ✅ 可用 或 ❌ 不可用
[VoiceService] 播放语音: "张爷爷，您好！今天感觉怎么样？"
```

## 🐛 问题诊断

### 问题 1: 没有看到 `[ElderlyApp] ✅ 最终识别结果`

**原因**：识别结果没有传递到 `handleSpeechResult`

**检查**：
- 是否看到 `[FunASR] ✅ 最终结果`？
- 如果看到 FunASR 的结果但没有 ElderlyApp 的日志，说明回调没有触发

**解决**：
- 检查 `speechService.startRecognition` 是否正确注册了回调
- 刷新页面重试

### 问题 2: 看到识别结果但没有 `[AI] 收到用户消息`

**原因**：`aiService.chat()` 没有被调用或调用失败

**检查**：
- 是否看到 `[ElderlyApp] 调用 AI 服务，输入: ...`？
- 查看是否有错误信息

**解决**：
- 查看控制台是否有错误
- 检查 `result.text` 是否为空

### 问题 3: 看到 AI 服务调用但没有回复文本

**原因**：AI 服务返回空响应

**检查**：
- 是否看到 `[AI] ✅ 使用本地回复` 或 `[AI] Gemini 回复`？
- 查看 `[ElderlyApp] ✅ AI 服务响应` 的内容

**解决**：
- 检查 AI 服务的返回值
- 查看是否有 `[ElderlyApp] ❌ AI 服务返回空文本` 错误

### 问题 4: 看到 AI 回复但没有语音

**原因**：Edge TTS 服务未运行

**检查**：
- 查看 `[ElderlyApp] Edge TTS 服务状态`
- 如果显示 `❌ 不可用`，需要启动服务

**解决**：
```bash
# 启动 Edge TTS 服务
python scripts/edge_tts_server.py
```

## 🔧 快速测试

在浏览器控制台运行以下代码测试 AI 服务：

```javascript
// 测试 AI 服务
import { aiService } from './services/aiService';
aiService.chat('你好').then(response => {
    console.log('AI 回复:', response);
}).catch(error => {
    console.error('AI 错误:', error);
});
```

## 📋 检查清单

- [ ] FunASR 服务器正在运行
- [ ] 浏览器控制台没有错误（红色）
- [ ] 看到 `[FunASR] ✅ 最终结果`
- [ ] 看到 `[ElderlyApp] ✅ 最终识别结果`
- [ ] 看到 `[AI] 收到用户消息`
- [ ] 看到 `[AI] ✅ 使用本地回复` 或 `[AI] Gemini 回复`
- [ ] 看到 `[ElderlyApp] ✅ AI 服务调用成功`
- [ ] 看到 `[VoiceService] 播放语音`
- [ ] Edge TTS 服务正在运行（如果显示不可用）

## 💡 常见问题

**Q: 识别成功但没有调用 AI 服务？**

A: 检查 `result.text` 是否为空，或者 `handleSpeechResult` 是否被正确调用。

**Q: AI 服务调用但没有回复？**

A: 检查 AI 服务的返回值，可能是返回了空文本。

**Q: 有回复但没有语音？**

A: 启动 Edge TTS 服务：`python scripts/edge_tts_server.py`

## 🎯 下一步

根据控制台输出，告诉我：
1. 你看到了哪些日志？
2. 在哪一步停止了？
3. 是否有任何错误信息（红色）？

这样我可以帮你精确定位问题！
